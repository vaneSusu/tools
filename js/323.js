(self.webpackChunkfabritor_web=self.webpackChunkfabritor_web||[]).push([[323],{1228:function(e,t,n){"use strict";n.d(t,{Bi:function(){return w},uE:function(){return x},vB:function(){return g}});var r,i,o,a,l,c=n(8177),u=n(5166),s=n(8703),f=n(9517),d=n(9938),h=n(6853),y=n(115),p=n(1613),v=n(847),b=n(6012),g=(r=(0,c._)(function(e){return(0,d.Jh)(this,function(t){return[2,new Promise(function(t,n){h.fabric.util.loadImage(e,function(e){return e?t(e):(b.ZP.error("\u52A0\u8F7D\u56FE\u7247\u5931\u8D25"),n())},null,"anonymous")})]})}),function(e){return r.apply(this,arguments)}),m=(i=(0,c._)(function(e){return(0,d.Jh)(this,function(t){return"string"==typeof e?[2,new Promise(function(t,n){h.fabric.Image.fromURL(e,function(e){if(!e){b.ZP.error("\u52A0\u8F7D\u56FE\u7247\u5931\u8D25"),n();return}t(e)},{crossOrigin:"anonymous"})})]:[2,Promise.resolve(new h.fabric.Image(e))]})}),function(e){return i.apply(this,arguments)}),S=(o=(0,c._)(function(e){return(0,d.Jh)(this,function(t){return[2,new Promise(function(t){h.fabric.loadSVGFromURL(e,function(e,n){t(h.fabric.util.groupSVGElements(e,n))})})]})}),function(e){return o.apply(this,arguments)}),w=(a=(0,c._)(function(e){var t,n,r,i,o,a;return(0,d.Jh)(this,function(l){switch(l.label){case 0:n=(t=e||{}).imageSource,t.left,t.top,r=(0,f._)(t,["imageSource","left","top"]),o=(i=(0,p.o)()).canvas,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,m(n)];case 2:return a=l.sent(),[3,4];case 3:return console.log(l.sent()),[3,4];case 4:if(!a)return[2];return a.set((0,s._)((0,u._)({},r),{paintFirst:"fill",id:(0,y.Vj)()})),(0,v.pp)(a,e,i),o.add(a),o.setActiveObject(a),o.requestRenderAll(),[2,a]}})}),function(e){return a.apply(this,arguments)}),x=(l=(0,c._)(function(e){var t,n,r,i,o;return(0,d.Jh)(this,function(a){switch(a.label){case 0:t=(e||{}).imageSource,r=(n=(0,p.o)()).canvas,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,m(t)];case 2:return i=a.sent(),[3,4];case 3:return console.log(a.sent()),[3,4];case 4:if(!i)return[2];return o=new h.fabric.FImage({image:i,id:(0,y.Vj)()}),(0,v.pp)(o,e,n),r.add(o),r.setActiveObject(o),r.requestRenderAll(),[2]}})}),function(e){return l.apply(this,arguments)});(0,c._)(function(e){var t,n,r,i,o,a;return(0,d.Jh)(this,function(l){switch(l.label){case 0:return n=(t=e||{}).url,t.left,t.top,r=(0,f._)(t,["url","left","top"]),o=(i=(0,p.o)()).canvas,[4,S(n)];case 1:return(a=l.sent()).set((0,s._)((0,u._)({},r),{id:(0,y.Vj)()})),(0,v.pp)(a,e,i),o.add(a),o.setActiveObject(a),o.requestRenderAll(),[2,a]}})})},6521:function(e,t,n){"use strict";n.d(t,{JE:function(){return g},bG:function(){return v},h1:function(){return p},we:function(){return b}});var r,i=n(8177),o=n(5166),a=n(8703),l=n(9517),c=n(9938),u=n(6853),s=n(9372),f=n(115),d=n(1613),h=n(847),y=function(e){var t=e.textLines||[];if(!t||!t.length)return 0;for(var n=0,r=0;r<t.length;r++)n+=e.measureLine(r).width;return n+4},p=function(e){if(!e.path)return 100;var t=Math.ceil(e.path.path[1][2]/(y(e)/2)*100);return t>100?100:t},v=function(e,t){var n=(0,d.o)().canvas;if(!e.isEditing){var r=y(e),i=new u.fabric.Path("M 0 0 Q ".concat(r/2," ").concat(r/2*t/100," ").concat(r," 0"),{visible:!1,stroke:"#000000",fill:"#00000000"});e.set({path:i,width:r}),n.requestRenderAll()}},b=function(e){var t=(0,d.o)().canvas;e.set({path:null}),t.requestRenderAll()},g=(r=(0,i._)(function(e){var t,n,r,i,y,b,g,m,S;return(0,c.Jh)(this,function(c){switch(c.label){case 0:if(r=void 0===(n=(t=e||{}).text)?"":n,t.left,t.top,i=t.fontFamily,y=(0,l._)(t,["text","left","top","fontFamily"]),g=(b=(0,d.o)()).canvas,m={hasPath:!1,offset:100},S=new u.fabric.FText(r||"\u8FD9\u662F\u4E00\u6BB5\u6587\u672C",(0,a._)((0,o._)({},s._P,y),{pathAlign:"center",id:(0,f.Vj)()})),(0,h.pp)(S,e,b),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,,3,4]),[4,(0,f.mx)(i)];case 2:return c.sent(),[3,4];case 3:return S.set("fontFamily",i),[7];case 4:return S.on("editing:entered",function(){S.path?(m.hasPath=!0,m.offset=p(S),S.set("path",null),S.initDimensions(),b.canvas.requestRenderAll()):m.hasPath=!1}),S.on("editing:exited",function(){m.hasPath&&(v(S,m.offset),b.canvas.requestRenderAll())}),g.add(S),g.setActiveObject(S),g.requestRenderAll(),[2,S]}})}),function(e){return r.apply(this,arguments)})},9372:function(e,t,n){"use strict";n.d(t,{TX:function(){return u},_P:function(){return c},b1:function(){return l},bI:function(){return i},jF:function(){return o},rS:function(){return f},vH:function(){return s},wl:function(){return a}});var r=n(7776),i=2,o="fabritor_schema_version",a="".concat("fabritor","_log\uFF1A"),l={borderColor:"#FF2222",borderScaleFactor:2,cornerStrokeColor:"#2222",cornerColor:"#FF2222",cornerSize:12,cornerStyle:"circle",transparentCorners:!1,padding:0,centeredScaling:!1,strokeUniform:!0,paintFirst:"stroke"},c={fill:"#000000",fontWeight:"normal",fontSize:50,lineHeight:1.3,textAlign:"center",fontFamily:"AlibabaPuHuiTi",width:500,splitByGrapheme:!0},u=[{label:(0,r.tZ)("span",{style:{fontFamily:"AlibabaPuHuiTi",fontSize:16},children:"\u963F\u91CC\u5DF4\u5DF4\u666E\u60E0\u4F53"}),value:"AlibabaPuHuiTi"},{label:(0,r.tZ)("span",{style:{fontFamily:"SourceHanSans",fontSize:16},children:"\u601D\u6E90\u9ED1\u4F53"}),value:"SourceHanSans"},{label:(0,r.tZ)("span",{style:{fontFamily:"SourceHanSerif",fontSize:16},children:"\u601D\u6E90\u5B8B\u4F53"}),value:"SourceHanSerif"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u65B9\u6B63\u6977\u4F53",fontSize:16},children:"\u65B9\u6B63\u6977\u4F53"}),value:"\u65B9\u6B63\u6977\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u5305\u56FE\u5C0F\u767D\u4F53",fontSize:16},children:"\u5305\u56FE\u5C0F\u767D\u4F53"}),value:"\u5305\u56FE\u5C0F\u767D\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u6C90\u7476\u8F6F\u7B14\u624B\u5199\u4F53",fontSize:16},children:"\u6C90\u7476\u8F6F\u7B14\u624B\u5199\u4F53"}),value:"\u6C90\u7476\u8F6F\u7B14\u624B\u5199\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u7AD9\u9177\u9AD8\u7AEF\u9ED1",fontSize:16},children:"\u7AD9\u9177\u9AD8\u7AEF\u9ED1"}),value:"\u7AD9\u9177\u9AD8\u7AEF\u9ED1"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u624B\u5199\u6742\u5B57\u4F53",fontSize:16},children:"\u624B\u5199\u6742\u5B57\u4F53"}),value:"\u624B\u5199\u6742\u5B57\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u80E1\u6653\u6CE2\u7537\u795E\u4F53",fontSize:16},children:"\u80E1\u6653\u6CE2\u7537\u795E\u4F53"}),value:"\u80E1\u6653\u6CE2\u7537\u795E\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u80E1\u6653\u6CE2\u9A9A\u5305\u4F53",fontSize:16},children:"\u80E1\u6653\u6CE2\u9A9A\u5305\u4F53"}),value:"\u80E1\u6653\u6CE2\u9A9A\u5305\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u6C90\u7476\u968F\u5FC3\u624B\u5199\u4F53",fontSize:16},children:"\u6C90\u7476\u968F\u5FC3\u624B\u5199\u4F53"}),value:"\u6C90\u7476\u968F\u5FC3\u624B\u5199\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u6E05\u677E\u624B\u5BEB\u9AD4",fontSize:16},children:"\u6E05\u677E\u624B\u5BEB\u9AD4"}),value:"\u6E05\u677E\u624B\u5BEB\u9AD4"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u7AD9\u9177\u9177\u9ED1\u4F53",fontSize:16},children:"\u7AD9\u9177\u9177\u9ED1\u4F53"}),value:"\u7AD9\u9177\u9177\u9ED1\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u7AD9\u9177\u5FEB\u4E50\u4F53",fontSize:16},children:"\u7AD9\u9177\u5FEB\u4E50\u4F53"}),value:"\u7AD9\u9177\u5FEB\u4E50\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u7AD9\u9177\u6587\u827A\u4F53",fontSize:16},children:"\u7AD9\u9177\u6587\u827A\u4F53"}),value:"\u7AD9\u9177\u6587\u827A\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u7AD9\u9177\u5C0F\u8587LOGO\u4F53",fontSize:16},children:"\u7AD9\u9177\u5C0F\u8587LOGO\u4F53"}),value:"\u7AD9\u9177\u5C0F\u8587LOGO\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u971E\u9E5C\u65B0\u6670\u9ED1",fontSize:16},children:"\u971E\u9E5C\u65B0\u6670\u9ED1"}),value:"\u971E\u9E5C\u65B0\u6670\u9ED1"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u971E\u9E5C\u5C1A\u667A\u9ED1",fontSize:16},children:"\u971E\u9E5C\u5C1A\u667A\u9ED1"}),value:"\u971E\u9E5C\u5C1A\u667A\u9ED1"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u971E\u9E5C\u6587\u6977",fontSize:16},children:"\u971E\u9E5C\u6587\u6977"}),value:"\u971E\u9E5C\u6587\u6977"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u5C0F\u8D56\u5B57\u4F53",fontSize:16},children:"\u5C0F\u8D56\u5B57\u4F53"}),value:"\u5C0F\u8D56\u5B57\u4F53"},{label:(0,r.tZ)("span",{style:{fontFamily:"\u60A0\u54C9\u5B57\u4F53",fontSize:16},children:"\u60A0\u54C9\u5B57\u4F53"}),value:"\u60A0\u54C9\u5B57\u4F53"}],s="fabritor-sketch",f=["id","fabritor_desc","selectable","hasControls","sub_type","arrowDelta","middleIndex","imageSource","imageBorder"]},1613:function(e,t,n){"use strict";n.d(t,{o:function(){return o},q:function(){return i}});var r,i=function(e){r=e},o=function(){return r}},847:function(e,t,n){"use strict";n.d(t,{GZ:function(){return b},RI:function(){return v},VY:function(){return y},Z8:function(){return m},Zw:function(){return p},dp:function(){return S},h7:function(){return g},jF:function(){return F},pp:function(){return w},qc:function(){return x},w7:function(){return O}});var r,i,o,a=n(8177),l=n(9938),c=n(6853),u=n(9372),s=n(6521),f=n(115),d=n(1228),h=c.fabric.controlsUtils,y=function(e,t){return t.width<e.width&&t.height<=e.height?1:Number((e.width/e.height<t.width/t.height?e.width/t.width:e.height/t.height).toFixed(2))},p=(r=(0,a._)(function(e,t){return(0,l.Jh)(this,function(n){return[2,new Promise(function(n){return(t||(t=e.getActiveObject()),t)?(navigator.clipboard.writeText(""),t.clone(function(e){return o=e,n(!0)},u.rS)):Promise.resolve(!1)})]})}),function(e,t){return r.apply(this,arguments)}),v=(i=(0,a._)(function(e){var t,n,r;return(0,l.Jh)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(0,f.k9)()];case 1:if(n=(t=i.sent()||{}).type,r=t.result)return"text"===n?(0,s.JE)({text:r}):"image"===n&&(0,d.uE)({imageSource:r}),[2];return[3,3];case 2:return console.error("Failed to read clipboard contents: ",i.sent()),[3,3];case 3:return o.clone(function(t){e.discardActiveObject(),t.set({left:t.left+50,top:t.top+50,evented:!0}),"activeSelection"===t.type?(t.canvas=e,t.forEachObject(function(t){e.add(t)}),t.setCoords()):e.add(t),e.setActiveObject(t),e.requestRenderAll(),e.fire("fabritor:clone",{target:t})},u.rS),[2]}})}),function(e){return i.apply(this,arguments)}),b=function(e,t){if(e||(e=t.getActiveObject()),e)return"activeSelection"===e.type?(e.getObjects().forEach(function(e){t.remove(e)}),t.discardActiveObject()):t.remove(e),t.requestRenderAll(),t.fire("fabritor:del",{target:null}),!0},g=function(e,t){t||(t=e.getActiveObject()),t&&"activeSelection"===t.type&&(t.toGroup(),e.requestRenderAll(),e.fire("fabritor:group"))},m=function(e,t){t||(t=e.getActiveObject()),t&&"group"===t.type&&(t.getObjects().forEach(function(e){e.set({lockMovementX:!1,lockMovementY:!1,hasControls:!0,selectable:!0})}),t.toActiveSelection(),e.requestRenderAll(),e.fire("fabritor:ungroup"))},S=function(e,t,n){if(n||(n=t.canvas.getActiveObject()),n&&"activeSelection"!==n.type){switch(e){case"layer-up":n.bringForward();break;case"layer-top":n.bringToFront();break;case"layer-down":n.sendBackwards();break;case"layer-bottom":n.sendToBack()}t.sketch.sendToBack(),t.canvas.requestRenderAll(),t.fireCustomModifiedEvent()}},w=function(e,t,n){var r=t||{},i=r.left,o=void 0===i?null:i,a=r.top,l=void 0===a?null:a,c=n.sketch;null==o&&(o=(c.width||0)/2-e.width/2),null==l&&(l=(c.height||0)/2-e.height/2),e.set({left:o,top:l})},x=function(e,t,n,r,i){var o=e.target,a=o.controls[e.corner],l=o.canvas.getZoom(),u=o.padding/l,s=o.toLocalPoint(new c.fabric.Point(r,i),t,n);return s.x>=u&&(s.x-=u),s.x<=-u&&(s.x+=u),s.y>=u&&(s.y-=u),s.y<=u&&(s.y+=u),s.x-=a.offsetX,s.y-=a.offsetY,s},F=h.wrapWithFireEvent("resizing",h.wrapWithFixedAnchor(function(e,t,n,r){var i=t.target,o=x(t,t.originX,t.originY,n,r),a=i.strokeWidth/(i.strokeUniform?i.scaleX:1),l="center"===t.originX&&"center"===t.originY?2:1,c=i.height,u=Math.abs(o.y*l/i.scaleY)-a;return i.set("height",Math.max(u,0)),c!==u})),O=function(e){var t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download="exported_data.json",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}},115:function(e,t,n){"use strict";n.d(t,{Sv:function(){return y},Vj:function(){return h},YX:function(){return b},jq:function(){return g},k9:function(){return S},mx:function(){return d}});var r,i,o,a=n(8177),l=n(5166),c=n(9938),u=n(5149),s=n(6588),f=n(9372),d=(r=(0,a._)(function(e){return(0,c.Jh)(this,function(t){return e&&f.TX.find(function(t){return t.value===e})?[2,new u(e).load(null,1e5).catch(function(e){console.error(f.wl,e)})]:[2,Promise.resolve()]})}),function(e){return r.apply(this,arguments)}),h=function(){return(0,s.Z)()},y=function(e,t,n){var r=document.createElement("a");r.href=e,r.download="".concat(n||h(),".").concat(t),document.body.appendChild(r),r.click(),document.body.removeChild(r)},p={45:JSON.stringify({x1:0,y1:1,x2:1,y2:0}),90:JSON.stringify({x1:0,y1:0,x2:1,y2:0}),135:JSON.stringify({x1:0,y1:0,x2:1,y2:1}),180:JSON.stringify({x1:0,y1:0,x2:0,y2:1}),225:JSON.stringify({x1:1,y1:0,x2:0,y2:1}),270:JSON.stringify({x1:1,y1:0,x2:0,y2:0}),315:JSON.stringify({x1:1,y1:1,x2:0,y2:0}),0:JSON.stringify({x1:0,y1:1,x2:0,y2:0})},v=function(e){var t=Object.keys(p),n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var c=o.value,u=(0,l._)({},e);if(u={x1:e.x1>1?1:0,y1:e.y1>1?1:0,x2:e.x2>1?1:0,y2:e.y2>1?1:0},JSON.stringify(u)===p[c])return Number(c)}}catch(s){r=!0,i=s}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return 90},b=function(e){return e&&"string"!=typeof e?{type:e.type,gradient:{colorStops:e.colorStops,angle:v(e.coords)}}:{type:"solid",color:e||"#ffffff"}},g=function(e){var t;switch(null==e?void 0:e.type){case"solid":t=e.color;break;case"linear":t={type:"linear",gradientUnits:"percentage",coords:JSON.parse(p[e.gradient.angle%360]||p[90]),colorStops:e.gradient.colorStops};break;case"radial":t={type:"radial",gradientUnits:"percentage",coords:{x1:.5,y1:.5,x2:.5,y2:.5,r1:0,r2:1},colorStops:e.gradient.colorStops}}return t},m=(i=(0,a._)(function(e,t){var n;return(0,c.Jh)(this,function(r){return(n=0===t.indexOf("text")?"text":0===t.indexOf("image/")?"image":"")?[2,new Promise(function(t){var r=new FileReader;r.onload=function(e){var r;t({type:n,result:null===(r=e.target)||void 0===r?void 0:r.result})},r.onerror=function(e){console.log(e),t(null)},"text"===n?r.readAsText(e):"image"===n&&r.readAsDataURL(e)})]:[2,Promise.resolve(null)]})}),function(e,t){return i.apply(this,arguments)}),S=(o=(0,a._)(function(){var e,t,n,r,i,o,a,l,u,s,f,d,h,y,p,v;return(0,c.Jh)(this,function(c){switch(c.label){case 0:return c.trys.push([0,17,,18]),[4,navigator.clipboard.read()];case 1:e=c.sent(),t=!0,n=!1,r=void 0,c.label=2;case 2:c.trys.push([2,14,15,16]),i=e[Symbol.iterator](),c.label=3;case 3:if(t=(o=i.next()).done)return[3,13];a=o.value,l=!0,u=!1,s=void 0,c.label=4;case 4:c.trys.push([4,10,11,12]),f=a.types[Symbol.iterator](),c.label=5;case 5:if(l=(d=f.next()).done)return[3,9];return h=d.value,[4,a.getType(h)];case 6:return[4,m.apply(void 0,[c.sent(),h])];case 7:if(y=c.sent())return[2,y];c.label=8;case 8:return l=!0,[3,5];case 9:return[3,12];case 10:return p=c.sent(),u=!0,s=p,[3,12];case 11:try{l||null==f.return||f.return()}finally{if(u)throw s}return[7];case 12:return t=!0,[3,3];case 13:return[3,16];case 14:return p=c.sent(),n=!0,r=p,[3,16];case 15:try{t||null==i.return||i.return()}finally{if(n)throw r}return[7];case 16:return[2,null];case 17:return console.error((v=c.sent()).name,v.message),[2,null];case 18:return[2]}})}),function(){return o.apply(this,arguments)})},1001:function(){},5287:function(){},7396:function(){}}]);